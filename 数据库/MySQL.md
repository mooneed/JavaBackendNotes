# 概述
数据库网课：MySQL45讲-丁奇（MySQL核心参考资料）（学习曲线较平缓，知识点之间分离度较低）
数据库博客：MySQL江湖路 | 专栏目录（可参考对MySQL45讲有一定补充）
数据库书籍：高性能MySQL
数据库作用：数据库用于存储和读取数据，对于业务端来说是一种共享资源。
数据库理论的各种架构设计主要为了保证数据库系统的高性能，数据一致性，高可用性。
下述架构设计中，√代表其主要目的，×代表对其他核心目的造成了负面影响。

数据库的主要指标：每秒事务数TPS，每秒查询数QPS。
# 事务
事务的特性AICD  
并发问题  
事务的隔离级别  
隔离级别的实现  
MVCC
# MySQL日志
# 性能优化
学习**性能优化**一节的顺序通常应该放置在索引和锁后。但是由于高性能是MySQL设计和使用的核心目标之一，且性能优化是对索引的利用，以及对锁引发的性能问题的规避。因此，先学习性能优化能够更好地理解索引的原理以及锁的缺点。（**`对于本节出现的索引和锁的相关概念可以略读后两节`**）
# 索引
# 锁
**锁的作用**：处理并发环境下的数据一致性问题。
**锁引入的问题**：降低性能。  
锁的性能问题的解决方案：降低锁的粒度，采用乐观锁，避免死锁，等。  
**MySQL锁**：  
（1）全局锁；  
（2）表级锁：表锁，元数据锁，意向锁，AUTO-INC锁；  
（3）行级锁：行锁，间隙锁，临键锁。 
分别处理全库备份的数据不一致；表结构更改的数据库不一致；快速检查表内是否有行锁；。  
## 全局锁
**全局锁的作用**：使整个数据库处于只读状态：阻塞数据的增删改操作，阻塞表结构的更改操作。
**全局锁加/解锁语句**：  
```SQL
flush tables with read lock
unlock tables
```  
**全局锁的适用场景**：全库逻辑备份。  
**全局锁的缺点**：造成业务停滞（不能增删改数据）。  
**全局锁的上位替代**：MVCC支持的可重复读隔离级别。  
## 表锁
**表锁的作用**：行锁出现前的核心锁。  
**表锁加/解锁语句**：
```SQL
// 粒度为表级的共享锁（读锁）
lock tables t_student read;
// 粒度为表级的独占锁（写锁）
lock tables t_student write;
// 释放当前会话所有表锁
unlock tables
```
**表锁的适用场景**：（1）事务更新大部分时（2）事务涉及多个表，容易引起死锁，造成事务回滚。
>Tips：除上述场景外，避免在InnoDB引擎使用表锁（粒度太大，影响并发性能），InnoDB实现了粒度更细的行级锁。

## 元数据锁MDL
**元数据锁的作用**：保证对表执行CRUD操作时，防止其他线程对表结构进行更改。  
**元数据锁加/解锁语句**：MDL锁由MySQL隐式自动加/解锁。对表执行CRUD操作时加**MDL读锁**，对表结构执行更改操作时加**MDL写锁**，事务提交后自动**释放**。  
**元数据锁的缺点**：MDL写锁阻塞orMDL写锁加锁，都会导致MDL读锁全部阻塞。（前者因为在MDL锁阻塞队列中MDL写锁的优先级高于MDL读锁，后者因为事务提交后MDL写锁才会被释放）（例：长事务导致阻塞MDL写锁or长事务中使用MDL写锁）  
## 意向锁
**意向锁的作用**：加独占表锁时，快速判断表中是否有行锁（如果没有意向锁的话，加独占表锁时需要逐行检查是否有行锁）。（**`意向锁仅和表锁冲突`** 从其作用也很容易看出）  
>Tips：表锁与行锁也满足读读共享，读写/写写互斥。

**意向锁加/解锁语句**：（加/解锁记录锁时自动加/解锁）  
```SQL
// 先在表上加上意向共享锁，然后对读取的记录加共享锁
select ... lock in share mode;

// 先在表上加上意向独占锁，然后对读取的记录加独占锁
select ... for update;
// 事务提交后自动释放
```
## AUTO-INC锁
**AUTO-INC锁的作用**：
**AUTO-INC锁加/解锁**：对主键自增的表插入
## 行锁
## 间隙锁
## 临键锁
## 插入意向锁
# MySQL分布式
